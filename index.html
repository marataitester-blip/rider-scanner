
<!DOCTYPE html>
<html lang="ru">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>TAROT SCANNER: RIDER WAITE</title>
Â  Â Â 
Â  Â  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.14.0/dist/ort.min.js"></script>
Â  Â Â 
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body { margin: 0; background: #0f0f0f; overflow: hidden; font-family: 'Roboto', sans-serif; color: #e0c097; }
Â  Â  Â  Â  #container { position: relative; width: 100vw; height: 100vh; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  video#input-video { width: 100%; height: 100%; object-fit: cover; display: none; }
Â  Â  Â  Â  canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

Â  Â  Â  Â  /* UI Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡ */
Â  Â  Â  Â  .ui-layer { position: absolute; top:0; left:0; width: 100%; height: 100%; pointer-events: none; display: flex; flex-direction: column; justify-content: space-between; z-index: 20; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .top-panel { background: rgba(0,0,0,0.85); padding: 15px; pointer-events: auto; border-bottom: 2px solid #e0c097; text-align: center; }
Â  Â  Â  Â  .app-title { font-family: 'Cinzel', serif; font-size: 22px; color: #e0c097; letter-spacing: 3px; text-shadow: 0 0 10px rgba(224, 192, 151, 0.5); }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .bottom-panel { padding: 30px; pointer-events: auto; text-align: center; background: linear-gradient(to top, rgba(0,0,0,0.95), transparent); }
Â  Â  Â  Â  .scan-btn { background: #e0c097; color: #000; border: 4px solid #bba078; width: 85px; height: 85px; border-radius: 50%; font-size: 40px; box-shadow: 0 0 30px rgba(224, 192, 151, 0.4); cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: transform 0.1s; }
Â  Â  Â  Â  .scan-btn:active { transform: scale(0.95); }

Â  Â  Â  Â  /* === ĞĞŸĞ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜Ğ™ ĞŸĞ Ğ˜Ğ¦Ğ•Ğ› (HUD) === */
Â  Â  Â  Â  .hud-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; opacity: 0.7; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºÑ€ĞµÑÑ‚Ğ¸Ğº */
Â  Â  Â  Â  .crosshair {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 40px; height: 40px;
Â  Â  Â  Â  }
Â  Â  Â  Â  .crosshair::before, .crosshair::after {
Â  Â  Â  Â  Â  Â  content: ''; position: absolute; background: rgba(224, 192, 151, 0.6);
Â  Â  Â  Â  }
Â  Â  Â  Â  .crosshair::before { top: 19px; left: 0; width: 40px; height: 2px; } /* Ğ“Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»ÑŒ */
Â  Â  Â  Â  .crosshair::after { top: 0; left: 19px; width: 2px; height: 40px; } /* Ğ’ĞµÑ€Ñ‚Ğ¸ĞºĞ°Ğ»ÑŒ */

Â  Â  Â  Â  /* Ğ£Ğ³Ğ»Ğ¾Ğ²Ñ‹Ğµ Ñ€Ğ°Ğ¼ĞºĞ¸ */
Â  Â  Â  Â  .scan-frame {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  width: 80%; height: 60%;
Â  Â  Â  Â  Â  Â  border: 2px solid rgba(224, 192, 151, 0.3);
Â  Â  Â  Â  Â  Â  border-radius: 20px;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 50px rgba(0,0,0,0.5) inset;
Â  Â  Â  Â  Â  Â  animation: breathe 3s infinite ease-in-out;
Â  Â  Â  Â  }
Â  Â  Â  Â  /* Ğ£Ğ³Ğ¾Ğ»ĞºĞ¸ Ñ€Ğ°Ğ¼ĞºĞ¸ */
Â  Â  Â  Â  .corner { position: absolute; width: 30px; height: 30px; border-color: #e0c097; border-style: solid; border-width: 0; }
Â  Â  Â  Â  .tl { top: -2px; left: -2px; border-top-width: 4px; border-left-width: 4px; border-radius: 10px 0 0 0; }
Â  Â  Â  Â  .tr { top: -2px; right: -2px; border-top-width: 4px; border-right-width: 4px; border-radius: 0 10px 0 0; }
Â  Â  Â  Â  .bl { bottom: -2px; left: -2px; border-bottom-width: 4px; border-left-width: 4px; border-radius: 0 0 0 10px; }
Â  Â  Â  Â  .br { bottom: -2px; right: -2px; border-bottom-width: 4px; border-right-width: 4px; border-radius: 0 0 10px 0; }

Â  Â  Â  Â  @keyframes breathe {
Â  Â  Â  Â  Â  Â  0% { width: 80%; height: 60%; opacity: 0.5; border-color: rgba(224, 192, 151, 0.2); }
Â  Â  Â  Â  Â  Â  50% { width: 82%; height: 62%; opacity: 1; border-color: rgba(224, 192, 151, 0.6); }
Â  Â  Â  Â  Â  Â  100% { width: 80%; height: 60%; opacity: 0.5; border-color: rgba(224, 192, 151, 0.2); }
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Ğ Ğ•Ğ—Ğ£Ğ›Ğ¬Ğ¢ĞĞ¢ */
Â  Â  Â  Â  #result-box {Â 
Â  Â  Â  Â  Â  Â  position: absolute; top: 0; left: 0; width: 100%; height: 100%;Â 
Â  Â  Â  Â  Â  Â  background: #111; z-index: 100; display: none; pointer-events: auto;
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .result-scroll-area { flex: 1; overflow-y: auto; padding: 20px; text-align: center; }
Â  Â  Â  Â  .cards-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-bottom: 30px; margin-top: 20px;}

Â  Â  Â  Â  .card-item { width: 30%; min-width: 90px; max-width: 140px; display: flex; flex-direction: column; align-items: center; cursor: pointer; }
Â  Â  Â  Â  .card-visual { width: 100%; border-radius: 6px; border: 1px solid #e0c097; }
Â  Â  Â  Â  .card-name-mini { font-size: 12px; margin-top: 8px; color: #fff; text-align: center; font-family: 'Cinzel', serif; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .close-res { margin: 20px; padding: 15px 40px; background: transparent; color: #e0c097; border: 1px solid #e0c097; font-weight: bold; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; font-family: 'Cinzel', serif; transition: 0.3s; }
Â  Â  Â  Â  .close-res:hover { background: #e0c097; color: #000; }

Â  Â  Â  Â  /* Ğ—Ğ£Ğœ */
Â  Â  Â  Â  #zoom-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); z-index: 200; display: none; justify-content: center; align-items: center; flex-direction: column; }
Â  Â  Â  Â  #zoom-title { color: #e0c097; font-family: 'Cinzel', serif; font-size: 24px; margin-bottom: 20px; }

Â  Â  Â  Â  /* Ğ­ĞšĞ ĞĞ Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ˜ */
Â  Â  Â  Â  #start-screen { position: absolute; top:0; left:0; width:100%; height:100%; background:#0f0f0f; z-index:999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.8s ease; }
Â  Â  Â  Â  .logo-text { font-family: 'Cinzel', serif; font-size: 32px; color: #e0c097; margin-bottom: 40px; text-align: center; letter-spacing: 4px; border-bottom: 1px solid #e0c097; padding-bottom: 10px; text-shadow: 0 0 15px #e0c097; }
Â  Â  Â  Â  #big-start-btn { padding: 15px 40px; font-size: 16px; background: transparent; color: #e0c097; border: 1px solid #e0c097; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: all 0.3s; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* ğŸ”¥ ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞĞ«Ğ™ Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡ */
Â  Â  Â  Â  .status-text {Â 
Â  Â  Â  Â  Â  Â  position: absolute; bottom: 130px; width: 100%; text-align: center;Â 
Â  Â  Â  Â  Â  Â  font-size: 20px; /* Ğ£Ğ’Ğ•Ğ›Ğ˜Ğ§Ğ˜Ğ› Ğ¨Ğ Ğ˜Ğ¤Ğ¢ */
Â  Â  Â  Â  Â  Â  font-weight: bold; letter-spacing: 1px;
Â  Â  Â  Â  Â  Â  text-shadow: 0 0 5px #000;Â 
Â  Â  Â  Â  Â  Â  color: #fff; background: rgba(0,0,0,0.4); padding: 8px;Â 
Â  Â  Â  Â  Â  Â  font-family: 'Cinzel', serif; /* ĞšÑ€Ğ°ÑĞ¸Ğ²Ñ‹Ğ¹ ÑˆÑ€Ğ¸Ñ„Ñ‚ */
Â  Â  Â  Â  }
Â  Â  Â  Â  #error-log { color: #ff5555; margin-top: 15px; font-size: 12px; max-width: 80%; text-align: center; }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="container">
Â  Â  Â  Â  <div id="start-screen">
Â  Â  Â  Â  Â  Â  <div class="logo-text">RIDER WAITE<br>TRIPLET</div>
Â  Â  Â  Â  Â  Â  <button id="big-start-btn" onclick="initSystem()">START SESSION</button>
Â  Â  Â  Â  Â  Â  <div id="loading-text" style="color: #666; margin-top: 15px; font-size: 12px; display: none;">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ½ĞµĞ¹Ñ€Ğ¾ÑĞµÑ‚Ğ¸ (Hardcore)...</div>
Â  Â  Â  Â  Â  Â  <div id="error-log"></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <video id="input-video" playsinline muted autoplay></video>
Â  Â  Â  Â  <canvas id="canvas"></canvas>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="hud-layer">
Â  Â  Â  Â  Â  Â  <div class="scan-frame">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="corner tl"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="corner tr"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="corner bl"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="corner br"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="crosshair"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <div class="ui-layer">
Â  Â  Â  Â  Â  Â  <div class="top-panel">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="app-title">RIDER HARDCORE</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="status" class="status-text">ĞĞ–Ğ˜Ğ”ĞĞĞ˜Ğ•...</div>
Â  Â  Â  Â  Â  Â  <div class="bottom-panel"><button class="scan-btn" onclick="captureRead()">ğŸ“·</button></div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="result-box">
Â  Â  Â  Â  Â  Â  <div class="result-scroll-area">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 style="color: #e0c097; font-family: 'Cinzel'; margin-bottom: 10px;">Ğ ĞĞ¡ĞšĞ›ĞĞ”</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="cards-container" class="cards-row"></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="color: #888; font-size: 12px; margin-top: 20px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  * Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ğ¼Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ°Ğ¼Ğ¸.<br>ĞŸĞµÑ€ĞµĞ²ĞµÑ€Ğ½ÑƒÑ‚Ñ‹Ğµ ĞºĞ°Ñ€Ñ‚Ñ‹ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚ÑÑ ĞºĞ°Ğº Ğ¿Ñ€ÑĞ¼Ñ‹Ğµ.
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <button class="close-res" onclick="closeResult()">ĞĞĞ’Ğ«Ğ™ Ğ¡ĞšĞĞ</button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="zoom-modal" onclick="closeZoom()">
Â  Â  Â  Â  Â  Â  <div id="zoom-title">ĞšĞ°Ñ€Ñ‚Ğ°</div>
Â  Â  Â  Â  Â  Â  <div id="zoom-media-placeholder"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // === 1. ĞĞ’Ğ¢Ğ-Ğ“Ğ•ĞĞ•Ğ ĞĞ¦Ğ˜Ğ¯ Ğ‘ĞĞ—Ğ« ĞšĞĞ Ğ¢ (RIDER WAITE) ===
Â  Â  Â  Â  const BASE_IMG_URL = "https://raw.githubusercontent.com/marataitester-blip/rider-tarot-card/main/Cards-jpg/Cards-jpg/";
Â  Â  Â  Â  const TAROT_DATA = [];

Â  Â  Â  Â  // Ğ¡Ñ‚Ğ°Ñ€ÑˆĞ¸Ğµ (0-21)
Â  Â  Â  Â  const majors = [
Â  Â  Â  Â  Â  Â  {n:"Ğ¨ÑƒÑ‚", f:"00-TheFool.jpg"}, {n:"ĞœĞ°Ğ³", f:"01-TheMagician.jpg"}, {n:"Ğ–Ñ€Ğ¸Ñ†Ğ°", f:"02-TheHighPriestess.jpg"},
Â  Â  Â  Â  Â  Â  {n:"Ğ˜Ğ¼Ğ¿ĞµÑ€Ğ°Ñ‚Ñ€Ğ¸Ñ†Ğ°", f:"03-TheEmpress.jpg"}, {n:"Ğ˜Ğ¼Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€", f:"04-TheEmperor.jpg"}, {n:"Ğ–Ñ€ĞµÑ†", f:"05-TheHierophant.jpg"},
Â  Â  Â  Â  Â  Â  {n:"Ğ’Ğ»ÑĞ±Ğ»ĞµĞ½Ğ½Ñ‹Ğµ", f:"06-TheLovers.jpg"}, {n:"ĞšĞ¾Ğ»ĞµÑĞ½Ğ¸Ñ†Ğ°", f:"07-TheChariot.jpg"}, {n:"Ğ¡Ğ¸Ğ»Ğ°", f:"08-Strength.jpg"},
Â  Â  Â  Â  Â  Â  {n:"ĞÑ‚ÑˆĞµĞ»ÑŒĞ½Ğ¸Ğº", f:"09-TheHermit.jpg"}, {n:"ĞšĞ¾Ğ»ĞµÑĞ¾ Ğ¤Ğ¾Ñ€Ñ‚ÑƒĞ½Ñ‹", f:"10-WheelOfFortune.jpg"}, {n:"Ğ¡Ğ¿Ñ€Ğ°Ğ²ĞµĞ´Ğ»Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ", f:"11-Justice.jpg"},
Â  Â  Â  Â  Â  Â  {n:"ĞŸĞ¾Ğ²ĞµÑˆĞµĞ½Ğ½Ñ‹Ğ¹", f:"12-TheHangedMan.jpg"}, {n:"Ğ¡Ğ¼ĞµÑ€Ñ‚ÑŒ", f:"13-Death.jpg"}, {n:"Ğ£Ğ¼ĞµÑ€ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ", f:"14-Temperance.jpg"},
Â  Â  Â  Â  Â  Â  {n:"Ğ”ÑŒÑĞ²Ğ¾Ğ»", f:"15-TheDevil.jpg"}, {n:"Ğ‘Ğ°ÑˆĞ½Ñ", f:"16-TheTower.jpg"}, {n:"Ğ—Ğ²ĞµĞ·Ğ´Ğ°", f:"17-TheStar.jpg"},
Â  Â  Â  Â  Â  Â  {n:"Ğ›ÑƒĞ½Ğ°", f:"18-TheMoon.jpg"}, {n:"Ğ¡Ğ¾Ğ»Ğ½Ñ†Ğµ", f:"19-TheSun.jpg"}, {n:"Ğ¡ÑƒĞ´", f:"20-Judgement.jpg"},
Â  Â  Â  Â  Â  Â  {n:"ĞœĞ¸Ñ€", f:"21-TheWorld.jpg"}
Â  Â  Â  Â  ];
Â  Â  Â  Â  majors.forEach(m => TAROT_DATA.push({ name: m.n, image: BASE_IMG_URL + m.f }));

Â  Â  Â  Â  // ĞœĞ»Ğ°Ğ´ÑˆĞ¸Ğµ (22-77)
Â  Â  Â  Â  const suits = [
Â  Â  Â  Â  Â  Â  {id: 'Wands', ru: 'Ğ–ĞµĞ·Ğ»Ğ¾Ğ²'}, {id: 'Cups', ru: 'ĞšÑƒĞ±ĞºĞ¾Ğ²'},Â 
Â  Â  Â  Â  Â  Â  {id: 'Swords', ru: 'ĞœĞµÑ‡ĞµĞ¹'}, {id: 'Pentacles', ru: 'ĞŸĞµĞ½Ñ‚Ğ°ĞºĞ»ĞµĞ¹'}
Â  Â  Â  Â  ];
Â  Â  Â  Â  const ranks = ['Ğ¢ÑƒĞ·', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'ĞŸĞ°Ğ¶', 'Ğ Ñ‹Ñ†Ğ°Ñ€ÑŒ', 'ĞšĞ¾Ñ€Ğ¾Ğ»ĞµĞ²Ğ°', 'ĞšĞ¾Ñ€Ğ¾Ğ»ÑŒ'];
Â  Â  Â  Â Â 
Â  Â  Â  Â  suits.forEach(s => {
Â  Â  Â  Â  Â  Â  ranks.forEach((r, idx) => {
Â  Â  Â  Â  Â  Â  Â  Â  const num = (idx + 1).toString().padStart(2, '0');
Â  Â  Â  Â  Â  Â  Â  Â  const fileName = `${s.id}${num}.jpg`;
Â  Â  Â  Â  Â  Â  Â  Â  TAROT_DATA.push({ name: `${r} ${s.ru}`, image: BASE_IMG_URL + fileName });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  // === 2. ĞĞĞ¡Ğ¢Ğ ĞĞ™ĞšĞ˜ (HARDCORE 800) ===
Â  Â  Â  Â  const MODEL_PATH = 'rider_hardcore.onnx'; // Ğ£Ğ±ĞµĞ´Ğ¸ÑÑŒ, Ñ‡Ñ‚Ğ¾ Ñ„Ğ°Ğ¹Ğ» Ñ‚Ğ°Ğº Ğ½Ğ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ!
Â  Â  Â  Â  const MODEL_SIZE = 800; // Ğ¥Ğ°Ñ€Ğ´ĞºĞ¾Ñ€ Ñ‚Ñ€ĞµĞ±ÑƒĞµÑ‚ 800px
Â  Â  Â  Â  const CONFIDENCE = 0.25;Â 
Â  Â  Â  Â  const NMS_THRESHOLD = 0.50;

Â  Â  Â  Â  let session;
Â  Â  Â  Â  let detectedCards = [];Â 
Â  Â  Â  Â  const status = document.getElementById('status');

Â  Â  Â  Â  ort.env.wasm.numThreads = 2;Â 
Â  Â  Â  Â  ort.env.wasm.simd = false;

Â  Â  Â  Â  async function initSystem() {
Â  Â  Â  Â  Â  Â  const btn = document.getElementById('big-start-btn');
Â  Â  Â  Â  Â  Â  const loadText = document.getElementById('loading-text');
Â  Â  Â  Â  Â  Â  const errorLog = document.getElementById('error-log');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  btn.style.display = 'none';
Â  Â  Â  Â  Â  Â  loadText.style.display = 'block';
Â  Â  Â  Â  Â  Â  errorLog.innerText = "";

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  // ĞšĞ°Ğ¼ĞµÑ€Ğ°
Â  Â  Â  Â  Â  Â  Â  Â  const stream = await navigator.mediaDevices.getUserMedia({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  video: { facingMode: 'environment', width: {ideal: 1280}, height: {ideal: 720} },Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  audio: falseÂ 
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  const video = document.getElementById('input-video');
Â  Â  Â  Â  Â  Â  Â  Â  video.srcObject = stream;
Â  Â  Â  Â  Â  Â  Â  Â  video.style.display = 'block';Â 
Â  Â  Â  Â  Â  Â  Â  Â  await new Promise(r => video.onloadedmetadata = r);

Â  Â  Â  Â  Â  Â  Â  Â  // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°
Â  Â  Â  Â  Â  Â  Â  Â  session = await ort.InferenceSession.create(MODEL_PATH, { executionProviders: ['wasm'] });

Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('start-screen').style.opacity = '0';
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { document.getElementById('start-screen').style.display = 'none'; }, 800);

Â  Â  Â  Â  Â  Â  Â  Â  status.innerText = "ĞŸĞĞ˜Ğ¡Ğš Ğ¦Ğ•Ğ›Ğ˜...";
Â  Â  Â  Â  Â  Â  Â  Â  status.style.color = "#888";
Â  Â  Â  Â  Â  Â  Â  Â  detectFrame(video);

Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  Â  Â  loadText.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  btn.style.display = 'inline-block';
Â  Â  Â  Â  Â  Â  Â  Â  btn.innerText = "ĞŸĞĞ’Ğ¢ĞĞ Ğ˜Ğ¢Ğ¬";
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  errorLog.innerText = "ĞĞ¨Ğ˜Ğ‘ĞšĞ: " + e.message;
Â  Â  Â  Â  Â  Â  Â  Â  if(e.message.includes("404")) errorLog.innerText += "\n(Ğ¤Ğ°Ğ¹Ğ» " + MODEL_PATH + " Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½)";
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function detectFrame(video) {
Â  Â  Â  Â  Â  Â  const canvas = document.getElementById('canvas');
Â  Â  Â  Â  Â  Â  const mat = document.createElement('canvas');
Â  Â  Â  Â  Â  Â  mat.width = MODEL_SIZE; mat.height = MODEL_SIZE;
Â  Â  Â  Â  Â  Â  mat.getContext('2d').drawImage(video, 0, 0, MODEL_SIZE, MODEL_SIZE);
Â  Â  Â  Â  Â  Â  const data = mat.getContext('2d').getImageData(0,0,MODEL_SIZE,MODEL_SIZE).data;
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const input = new Float32Array(3 * MODEL_SIZE * MODEL_SIZE);
Â  Â  Â  Â  Â  Â  for (let i=0; i<MODEL_SIZE*MODEL_SIZE; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  input[i] = data[i*4]/255.0;
Â  Â  Â  Â  Â  Â  Â  Â  input[MODEL_SIZE*MODEL_SIZE+i] = data[i*4+1]/255.0;
Â  Â  Â  Â  Â  Â  Â  Â  input[2*MODEL_SIZE*MODEL_SIZE+i] = data[i*4+2]/255.0;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  const tensor = new ort.Tensor('float32', input, [1, 3, MODEL_SIZE, MODEL_SIZE]);

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const results = await session.run({ [session.inputNames[0]]: tensor });
Â  Â  Â  Â  Â  Â  Â  Â  const output = results[session.outputNames[0]].data;
Â  Â  Â  Â  Â  Â  Â  Â  detectedCards = processAndDraw(output, canvas, video.videoWidth, video.videoHeight);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if (detectedCards.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status.innerText = `Ğ—ĞĞ¥Ğ’ĞĞ§Ğ•ĞĞ ĞšĞĞ Ğ¢: ${detectedCards.length}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status.style.color = "#d4af37";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status.style.textShadow = "0 0 10px #d4af37";
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status.innerText = "ĞŸĞĞ˜Ğ¡Ğš Ğ¦Ğ•Ğ›Ğ˜...";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status.style.color = "#888";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status.style.textShadow = "none";
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (e) { console.error(e); }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  setTimeout(() => requestAnimationFrame(() => detectFrame(video)), 50);
Â  Â  Â  Â  }

Â  Â  Â  Â  function processAndDraw(data, canvas, vW, vH) {
Â  Â  Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  Â  Â  ctx.clearRect(0,0,vW,vH);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  const numClasses = 78; // Rider Waite - 78 classes
Â  Â  Â  Â  Â  Â  const channels = numClasses + 4;Â 
Â  Â  Â  Â  Â  Â  const dynamicAnchors = data.length / channels;Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  let boxes = [];
Â  Â  Â  Â  Â  Â  for (let i=0; i<dynamicAnchors; i++) {
Â  Â  Â  Â  Â  Â  Â  Â  let maxConf = 0;
Â  Â  Â  Â  Â  Â  Â  Â  let classIdx = 0;
Â  Â  Â  Â  Â  Â  Â  Â  for(let c=4; c<channels; c++) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const val = data[c*dynamicAnchors+i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(val > maxConf) { maxConf = val; classIdx = c-4; }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  if (maxConf > CONFIDENCE) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const x = data[0*dynamicAnchors+i]; const y = data[1*dynamicAnchors+i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const w = data[2*dynamicAnchors+i]; const h = data[3*dynamicAnchors+i];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  boxes.push({ x: x, y: y, w: w, h: h, score: maxConf, classId: classIdx });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  boxes.sort((a,b) => b.score - a.score);
Â  Â  Â  Â  Â  Â  const cleanBoxes = [];
Â  Â  Â  Â  Â  Â  while(boxes.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const best = boxes.shift();
Â  Â  Â  Â  Â  Â  Â  Â  cleanBoxes.push(best);
Â  Â  Â  Â  Â  Â  Â  Â  boxes = boxes.filter(b => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const x1 = Math.max(best.x - best.w/2, b.x - b.w/2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const y1 = Math.max(best.y - best.h/2, b.y - b.h/2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const x2 = Math.min(best.x + best.w/2, b.x + b.w/2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const y2 = Math.min(best.y + best.h/2, b.y + b.h/2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const inter = (Math.min(x2,x2) - Math.max(x1,x1)) * (Math.min(y2,y2) - Math.max(y1,y1));Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (x2 < x1 || y2 < y1) return true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const areaI = (x2-x1)*(y2-y1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const areaU = best.w*best.h + b.w*b.h - areaI;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return (areaI/areaU) < NMS_THRESHOLD;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const sx = vW/MODEL_SIZE; const sy = vH/MODEL_SIZE;
Â  Â  Â  Â  Â  Â  const finalCards = [];

Â  Â  Â  Â  Â  Â  ctx.lineWidth = 2; ctx.font = "16px Roboto";Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  cleanBoxes.forEach(box => {
Â  Â  Â  Â  Â  Â  Â  Â  const realX = (box.x - box.w/2) * sx;
Â  Â  Â  Â  Â  Â  Â  Â  const realY = (box.y - box.h/2) * sy;
Â  Â  Â  Â  Â  Â  Â  Â  const realW = box.w * sx;
Â  Â  Â  Â  Â  Â  Â  Â  const realH = box.h * sy;

Â  Â  Â  Â  Â  Â  Â  Â  ctx.strokeStyle = "rgba(224, 192, 151, 0.8)";
Â  Â  Â  Â  Â  Â  Â  Â  ctx.strokeRect(realX, realY, realW, realH);
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  let card = TAROT_DATA[box.classId];
Â  Â  Â  Â  Â  Â  Â  Â  if(card) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  finalCards.push({ id: box.classId, x: realX, name: card.name, image: card.image });
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Ğ£Ğ½Ğ¸ĞºĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ¾Ñ‚Ñ€Ğ¸ÑĞ¾Ğ²ĞºĞ° Ğ¸Ğ¼ĞµĞ½
Â  Â  Â  Â  Â  Â  const unique = []; const seen = new Set();
Â  Â  Â  Â  Â  Â  for (const c of finalCards) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!seen.has(c.id)) { seen.add(c.id); unique.push(c); }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return unique;
Â  Â  Â  Â  }

Â  Â  Â  Â  function captureRead() {
Â  Â  Â  Â  Â  Â  if (detectedCards.length === 0) { alert("ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ½Ğµ Ğ²Ğ¸Ğ´Ğ¸Ñ‚ ĞºĞ°Ñ€Ñ‚Ñ‹!"); return; }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  // ğŸ”¥ Ğ¡ĞĞ Ğ¢Ğ˜Ğ ĞĞ’ĞšĞ Ğ¡Ğ›Ğ•Ğ’Ğ ĞĞĞŸĞ ĞĞ’Ğ (ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ´Ğ»Ñ Ñ‚Ñ€Ğ¸Ğ¿Ğ»ĞµÑ‚Ğ¾Ğ²)
Â  Â  Â  Â  Â  Â  detectedCards.sort((a, b) => a.x - b.x);

Â  Â  Â  Â  Â  Â  const container = document.getElementById('cards-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = "";

Â  Â  Â  Â  Â  Â  detectedCards.forEach(c => {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'card-item';
Â  Â  Â  Â  Â  Â  Â  Â  div.onclick = () => openZoom(c);
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `<img src="${c.image}" class="card-visual"><div class="card-name-mini">${c.name}</div>`;
Â  Â  Â  Â  Â  Â  Â  Â  container.appendChild(div);
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  document.getElementById('result-box').style.display = 'flex';
Â  Â  Â  Â  }

Â  Â  Â  Â  function closeResult() { document.getElementById('result-box').style.display = 'none'; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  function openZoom(card) {
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('zoom-modal');
Â  Â  Â  Â  Â  Â  const placeholder = document.getElementById('zoom-media-placeholder');
Â  Â  Â  Â  Â  Â  placeholder.innerHTML = `<img src="${card.image}" style="max-width: 90vw; max-height: 70vh; border: 2px solid #e0c097;">`;
Â  Â  Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  }
Â  Â  Â  Â  function closeZoom() { document.getElementById('zoom-modal').style.display = 'none'; }
Â  Â  </script>
</body>
</html>
