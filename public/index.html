<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AURA ZERO: DEEP CHECK</title>
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.1/dist/ort.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #00ffea; font-family: monospace; text-align: center; }
        #log { padding: 20px; font-size: 12px; text-align: left; white-space: pre-wrap; color: #ffd700; }
        .err { color: #ff4444; }
    </small></style>
</head>
<body>

<div id="loader">
    <h2 style="letter-spacing: 5px;">AURA AI ZERO</h2>
    <div id="status">ПРОВЕРКА СВЯЗИ...</div>
    <div id="log"></div>
</div>

<div id="scanner" style="display:none;">
    <video id="webcam" playsinline muted autoplay style="width:100%;"></video>
</div>

<script>
function logger(msg, isErr = false) {
    const logDiv = document.getElementById('log');
    logDiv.innerHTML += `<div class="${isErr ? 'err' : ''}">> ${msg}</div>`;
}

async function init() {
    try {
        logger("Запуск инициализации...");
        
        // 1. Тест физического наличия модели
        logger("Проверка файла tarot_best.onnx...");
        const response = await fetch('tarot_best.onnx', { method: 'HEAD' });
        if (!response.ok) throw new Error(`Файл не найден (Статус: ${response.status}). Убедись, что он в папке public.`);
        logger("Файл модели обнаружен на сервере.");

        // 2. Настройка путей WASM
        ort.env.wasm.wasmPaths = "https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.1/dist/";
        ort.env.wasm.numThreads = 1;
        logger("WASM пути настроены.");

        // 3. Создание сессии
        logger("Попытка создания сессии ORT...");
        const session = await ort.InferenceSession.create('./tarot_best.onnx', {
            executionProviders: ['wasm'],
            graphOptimizationLevel: 'all'
        });
        
        logger("УСПЕХ: Сессия создана. Входы: " + session.inputNames);
        document.getElementById('status').innerText = "ИНТЕЛЛЕКТ ЗАГРУЖЕН";
        
        // Включение камеры
        startCamera();

    } catch (e) {
        logger("КРИТИЧЕСКИЙ СБОЙ: " + (e.message || e), true);
        if (typeof e === 'number') logger("Код ошибки WASM: " + e + ". Это часто означает неверный MIME-тип файла.", true);
        console.error(e);
    }
}

async function startCamera() {
    try {
        const video = document.getElementById('webcam');
        const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
        video.srcObject = stream;
        document.getElementById('scanner').style.display = 'block';
    } catch (err) {
        logger("Ошибка камеры: " + err.message, true);
    }
}

window.onload = init;
</script>
</body>
</html>
